# АИС "УГ МГУ"

## Загрузка базы данных - integration.py

Скрипт **integration.py** отвечает за то, чтобы загрузить все необходимые таблицы в базу данных.

Предварительно от администратора необходимо подготовить несколько таблицы формата CSV с кодировкой UTF-8 или таблицы
XLSX (XLS). Все необходимые таблицы хранятся в каталоге проекта ***tables***.

1. **cur<year>.xlsx** - таблица с учебными планами. Главное -- чтобы они из года в год сохраняли "шапку".

2. **foreign_languages.csv** - таблица с языковыми группами и преподавателями этих групп. Столбцы таблицы:
    1. *lang* - название языка на английском языке;
    2. *n_group* - номер языковой группы;
    3. *language* - название языка на русском языке;
    4. *teacher* - преподаватель группы (фамилия, инициалы).

3. **kvd.csv** - таблица с курсами внеурочной деятельности представляет собой пересечение модуля и ученика. "1" в этой
   таблице обозначает, что ученик посещает данный модуль.

4. **students.csv** - таблица контингента Гимназии:
    1. *№* - порядковый номер гимназиста (не обязательный параметр);
    2. *ФИО* - фамилия, имя и отчество ученика, записанные через пробел. Возможно, не будет работать при учениках с
       двойными именами или фамилиями;
    3. *Подпрофиль* - класс, профиль и номер подпрофиля;
    4. *Подгруппа* - группа по английскому языку;
    5. *Второй ин. язык* - название второго иностранного языка;
    6. *гр.* - номер группы по иностранному языку.

5. **subjects.csv** - таблица с преподавательским составом и преподаваемыми предметами:
    1. *Предмет* - предмет, который ведёт данный преподаватель;
    2. *Преподаватель* - фамилия и инициалы преподавателя;
    3. *Класс* - класс, в котором он ведёт свой предмет;
    4. *Профиль* - профиль, в котором он работает;
    5. *Подпрофиль* - подпрофиль, для которого данный предмет читается.

### `def import_kvds(cur)`

Аргумент функции -- курсор базы данных.

Функция подключается к БД, чтобы загрузить в нее данные из таблицы **kvd.csv**. Так как первые две строки таблицы -- это
данные с названием модуля и его преподавателями, поэтому первые пустые ячейки в столбцах второй строки заполнены
строкой "tmp". В ходе работы функции формируется словарь, в котором ключ -- это название модуля, а значение список
слушателей. Первым в этом списке является преподаватель модуля.

В конце работы функции вызвана функция ***upload_kvds_in_students***, которая обновляет данные в таблице *students* в БД
о модулях, которые слушают гимназисты.

### `def update_kvds_in_students(cur)`

Аргумент функции -- курсор базы данных.

Функция обновляет информацию о модулях в таблице *students*. Она запрашивает информацию о слушателях курса из таблицы
*kvds*, а затем проходит по нему и по id слушателя добавляет id курса в строку kvds таблицы *students*. Если такой курс
уже есть среди курсов слушателя, то запись не происходит.

### `def import_students(cur)`

Аргумент функции -- курсор базы данных.

Функция читает данные из таблицы **students.csv**. Данные сразу прочитываются как словарь, далее идёт подготовка для
записи их в таблицу *students*. Так как у 8-х и 9-х классов нет профиля и подпрофиля, поэтому информация о них
заполняется как NULL. Также заполняются данные про проект и курсы внеурочной деятельности, так как обновление информации
по ним происходит после импорта соответствующих таблиц.

### `def import_subjects(cur)`

Аргумент функции -- курсор базы данных.

Функция обрабатывает таблицу **subjects.csv**. Данные переносятся в соответствии с исходными в таблицу *subjects* внутри
БД. Столбик профиль и подпрофиль для 8 и 9 классов содержит значение NULL.

***NOTA BENE!*** Необходимо дополнить таблицу **subjects.csv** данными про 8, 9 и 10ЭМ класс, так как при первоначальной
работе с расписанием информация об этих классах заносилась вручную.

### `def parse_excel_to_dict(files)`

Аргумент функции -- список относительных имён файлов с учебными планами.

Из таблиц с учебными планами формируется словарь по следующему принципу:
ключ -- направление подготовки по формату <класс><профиль>-<подпрофиль>-<год>, значение -- словарь:
ключ -- учебный предмет, изучаемый в профиле, значение -- картеж из двух элементов:
первый -- уровень изучения (базовый/углубленный), второй -- словарь

### `def import_curriculum(cur, data)`

Аргументы функции -- курсор базы данных, словарь, полученный из функции *parse_excel_to_dict*.

Функция импортирует словарь в таблицу *curriculum* базы данных.

### `def import_foreign_languages(cur)`

Аргумент функции -- курсор базы данных.

Функция импортирует данные из таблицы **foreign_languages.csv** в таблицу БД. 
